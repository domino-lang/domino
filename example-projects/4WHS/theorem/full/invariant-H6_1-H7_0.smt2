
(define-state-relation relation-no-overwriting-prf
    ((left  <GameState_H6_<$<!n!>$>>)
     (right  <GameState_H7_<$<!n!>$>>))
  (forall ((i Int))
          (and
           (=> (= (select left.PRF.H i) (as mk-none (Maybe Bool)))
               (= (select left.PRF.LTK i) (as mk-none (Maybe Bits_n))))
           (=> (= (select left.PRF.LTK i) (as mk-none (Maybe Bits_n)))
               (= (select left.PRF.H i) (as mk-none (Maybe Bool))))
           (=> (> i left.PRF.kid_)
               (and (= (select left.PRF.H i)
                       (as mk-none (Maybe Bool)))
                    (= (select left.PRF.LTK i)
                       (as mk-none (Maybe Bits_n))))))))


(define-fun key-not-computed-unless-test-or-reveal
    ((state (Array Int (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                       (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                       (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int))))
     (revtest (Array (Tuple5 Int Int Bits_n Bits_n Bits_n) (Maybe Bool)))
     (prf (Array (Tuple2 Int (Tuple5 Int Int Bits_n Bits_n Bool)) (Maybe Bits_n)))
     (H (Array Int (Maybe Bool))))
  Bool
  (and
   ;; mac keys are computed before output keys
   (forall ((kid Int)
            (U Int)
            (V Int)
            (ni Bits_n)
            (nr Bits_n))
           (=> (not (= (select prf (mk-tuple2 kid (mk-tuple5 U V ni nr true)))
                       (as mk-none (Maybe Bits_n))))
               (not (= (select prf (mk-tuple2 kid (mk-tuple5 U V ni nr false)))
                       (as mk-none (Maybe Bits_n))))))

   ;; output keys are only computed when revtesting
   (forall ((kid Int)
            (U Int)
            (V Int)
            (ni Bits_n)
            (nr Bits_n)
            (kmac-prime Bits_n))
           (and
            ;; entry in PRF table => entry in revtest
            (=> (not (= (select prf (mk-tuple2 kid (mk-tuple5 U V ni nr true)))
                        (as mk-none (Maybe Bits_n))))
                (let ((kmac (select prf (mk-tuple2 kid (mk-tuple5 U V ni nr false)))))
                  (let ((tau (<<func-mac>> (maybe-get kmac) nr 2)))
                    (not (= (select revtest (mk-tuple5 U V ni nr tau))
                            (as mk-none (Maybe Bool)))))))

            ;; revtest none => prf none
            (=> (let ((tau (<<func-mac>> kmac-prime nr 2)))
                  (= (select revtest (mk-tuple5 U V ni nr tau))
                     (as mk-none (Maybe Bool))))
                (=> (= (select prf (mk-tuple2 kid (mk-tuple5 U V ni nr false)))
                       (mk-some kmac-prime))
                    (= (select prf (mk-tuple2 kid (mk-tuple5 U V ni nr true)))
                       (as mk-none (Maybe Bits_n)))))))))


(define-fun stuff-not-initialized-early
    ((state (Array Int (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                       (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                       (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int)))))
  Bool
  (let ((none (as mk-none (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                          (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                          (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int)))))
    (forall ((ctr Int))
            (let ((state (select state ctr)))
              (=> (not (= state none))
                  (let  ((U    (el11-1  (maybe-get state)))
                         (u    (el11-2  (maybe-get state)))
                         (V    (el11-3  (maybe-get state)))
                         (ltk  (el11-4  (maybe-get state)))
                         (acc  (el11-5  (maybe-get state)))
                         (k    (el11-6  (maybe-get state)))
                         (ni   (el11-7  (maybe-get state)))
                         (nr   (el11-8  (maybe-get state)))
                         (kmac (el11-9  (maybe-get state)))
                         (sid  (el11-10 (maybe-get state)))
                         (mess (el11-11 (maybe-get state))))
                    (and (ite u
                              (ite (= mess 0)
                                   (and (= sid (as mk-none (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n))))
                                        (= ni nr kmac (as mk-none (Maybe Bits_n)))
                                        (= acc (as mk-none (Maybe Bool))))
                                   (and (ite (= mess 1) (= acc (as mk-none (Maybe Bool))) (not (= acc (as mk-none (Maybe Bool)))))
                                        (=> (> mess 0)
                                            (and (not (= sid (as mk-none (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)))))
                                                 (not (= kmac (as mk-none (Maybe Bits_n))))
                                                 (not (= ni (as mk-none (Maybe Bits_n))))
                                                 (not (= nr (as mk-none (Maybe Bits_n))))))))
                              (ite (= mess 0)
                                   (and (= sid (as mk-none (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n))))
                                        (= ni nr kmac (as mk-none (Maybe Bits_n)))
                                        (= acc (as mk-none (Maybe Bool))))
                                   (ite (= mess 1)
                                        (and (not (= ni (as mk-none (Maybe Bits_n))))
                                             (= acc (as mk-none (Maybe Bool)))
                                             (= nr kmac (as mk-none (Maybe Bits_n)))
                                             (= sid (as mk-none (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)))))
                                        (and (not (= sid (as mk-none (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)))))
                                             (not (= kmac (as mk-none (Maybe Bits_n))))
                                             (not (= ni (as mk-none (Maybe Bits_n))))
                                             (not (= nr (as mk-none (Maybe Bits_n)))))))))))))))


(define-fun other-stuff-not-initialized-early
    ((State1 (Array Int (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                        (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                        (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int))))
     (Fresh1 (Array Int (Maybe Bool)))
     (Keys1 (Array (Tuple5 Int Int Int Bits_n Bits_n) (Maybe Bits_n))))
  Bool
  (let ((none (as mk-none (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                          (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                          (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int)))))
    (forall ((ctr Int))
            (let ((state (select State1 ctr)))
              (=> (not (= state none))
                  (let  ((U    (el11-1  (maybe-get state)))
                         (u    (el11-2  (maybe-get state)))
                         (V    (el11-3  (maybe-get state)))
                         (kid  (el11-4  (maybe-get state)))
                         (acc  (el11-5  (maybe-get state)))
                         (k    (el11-6  (maybe-get state)))
                         (ni   (el11-7  (maybe-get state)))
                         (nr   (el11-8  (maybe-get state)))
                         (kmac (el11-9  (maybe-get state)))
                         (sid  (el11-10 (maybe-get state)))
                         (mess (el11-11 (maybe-get state))))
                    (and (not (is-mk-none (select Fresh1 ctr)))
                         (ite u
                              (ite (> mess 0)
                                   (and (ite (= mess 1) (= acc (as mk-none (Maybe Bool))) (not (= acc (as mk-none (Maybe Bool)))))
                                        (not (= sid (as mk-none (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)))))
                                        (ite (= (select Fresh1 ctr) (mk-some true))
                                             (not (is-mk-none (select Keys1 (mk-tuple5 kid U V (maybe-get ni) (maybe-get nr)))))
                                             (not (is-mk-none kmac)))
                                        (not (= ni (as mk-none (Maybe Bits_n))))
                                        (not (= nr (as mk-none (Maybe Bits_n)))))
                                   (and (= sid (as mk-none (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n))))
                                        (= ni nr kmac (as mk-none (Maybe Bits_n)))))
                              (ite (= mess 0)
                                   (and (= sid (as mk-none (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n))))
                                        (= ni nr kmac (as mk-none (Maybe Bits_n)))
                                        (= acc (as mk-none (Maybe Bool))))
                                   (ite (= mess 1)
                                        (and (not (= ni (as mk-none (Maybe Bits_n))))
                                             (= nr kmac (as mk-none (Maybe Bits_n)))
                                             (= sid (as mk-none (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n))))
                                             (= acc (as mk-none (Maybe Bool))))
                                        (and (not (= sid (as mk-none (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)))))
                                             (ite (= (select Fresh1 ctr) (mk-some true))
                                                  (not (is-mk-none (select Keys1 (mk-tuple5 kid U V (maybe-get ni) (maybe-get nr)))))
                                                  (not (is-mk-none kmac)))
                                             (not (= ni (as mk-none (Maybe Bits_n))))
                                             (not (= nr (as mk-none (Maybe Bits_n)))))))))))))))


(define-fun state-equality
    ((State0 (Array Int (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                        (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                        (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int))))
     (State1 (Array Int (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                        (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                        (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int))))
     (Fresh1 (Array Int (Maybe Bool))))
  Bool
  (let ((none (as mk-none (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                          (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                          (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int)))))
    (forall ((ctr Int))
            (and
             (= (is-mk-none (select State1 ctr))
                (is-mk-none (select State0 ctr)))
             (let ((state0 (select State0 ctr)))
               (=> (not (= state0 none))
                   (let  ((U    (el11-1  (maybe-get state0)))
                          (u    (el11-2  (maybe-get state0)))
                          (V    (el11-3  (maybe-get state0)))
                          (ltk  (el11-4  (maybe-get state0)))
                          (acc  (el11-5  (maybe-get state0)))
                          (k    (el11-6  (maybe-get state0)))
                          (ni   (el11-7  (maybe-get state0)))
                          (nr   (el11-8  (maybe-get state0)))
                          (kmac (el11-9  (maybe-get state0)))
                          (sid  (el11-10 (maybe-get state0)))
                          (mess (el11-11 (maybe-get state0))))
                     (ite (= (select Fresh1 ctr) (mk-some true))
                          (= (select State1 ctr)
                             (mk-some (mk-tuple11 U u V ltk acc k ni nr (as mk-none (Maybe Bits_n)) sid mess)))
                          (= (select State1 ctr) state0)))))))))


(define-fun prf-equality
    ((Prf0 (Array (Tuple2 Int (Tuple5 Int Int Bits_n Bits_n Bool)) (Maybe Bits_n)))
     (Prf1 (Array (Tuple2 Int (Tuple5 Int Int Bits_n Bits_n Bool)) (Maybe Bits_n)))
     (Keys1 (Array (Tuple5 Int Int Int Bits_n Bits_n) (Maybe Bits_n))))
  Bool
  (forall ((kid Int) (U Int) (V Int) (ni Bits_n) (nr Bits_n))
          (and
           (= (select Prf0 (mk-tuple2 kid (mk-tuple5 U V ni nr true)))
              (select Prf1 (mk-tuple2 kid (mk-tuple5 U V ni nr true))))
           (= (select Prf0 (mk-tuple2 kid (mk-tuple5 U V ni nr false)))
              (select Keys1 (mk-tuple5 kid U V ni nr))))))



(define-fun all-sessions-have-valid-keys
    ((state (Array Int (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                       (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                       (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int))))
     (ltk (Array Int (Maybe Bits_n))))
  Bool
  (let ((none (as mk-none (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                          (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                          (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int)))))
    (forall ((ctr Int))
            (let ((state (select state ctr)))
              (=> (not (= state none))
                  (let  ((kid  (el11-4  (maybe-get state))))
                    (not (= (select ltk kid) (as mk-none (Maybe Bits_n))))))))))



(define-fun kmac-sampled-consistently
    ((prf (Array (Tuple2 Int (Tuple5 Int Int Bits_n Bits_n Bool)) (Maybe Bits_n)))
     (keys (Array (Tuple5 Int Int Int Bits_n Bits_n) (Maybe Bits_n))))
  Bool
  (forall ((kid Int) (U Int) (V Int) (ni Bits_n) (nr Bits_n))
          (and
           (=> (= (select prf (mk-tuple2 kid (mk-tuple5 U V ni nr false)))
                  (as mk-none (Maybe Bits_n)))
               (= (select keys (mk-tuple5 kid U V ni nr))
                  (as mk-none (Maybe Bits_n))))
           (=> (= (select keys (mk-tuple5 kid U V ni nr))
                  (as mk-none (Maybe Bits_n)))
               (= (select prf (mk-tuple2 kid (mk-tuple5 U V ni nr false)))
                  (as mk-none (Maybe Bits_n)))))))


(define-fun kmac-consistent-in-state-and-mac
    ((State0 (Array Int (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                        (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                        (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int))))
     (State1 (Array Int (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                        (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                        (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int))))
     (Fresh1 (Array Int (Maybe Bool)))
     (Keys1 (Array (Tuple5 Int Int Int Bits_n Bits_n) (Maybe Bits_n))))
  Bool
  (forall ((ctr Int))
          (let ((state (select State0 ctr)))
            (=> (not (is-mk-none state))
                (let  ((U    (el11-1  (maybe-get state)))
                       (u    (el11-2  (maybe-get state)))
                       (V    (el11-3  (maybe-get state)))
                       (kid  (el11-4  (maybe-get state)))
                       (acc  (el11-5  (maybe-get state)))
                       (k    (el11-6  (maybe-get state)))
                       (ni   (el11-7  (maybe-get state)))
                       (nr   (el11-8  (maybe-get state)))
                       (kmac (el11-9  (maybe-get state)))
                       (sid  (el11-10 (maybe-get state)))
                       (mess (el11-11 (maybe-get state))))
                  (=> (not (= kmac (as mk-none (Maybe Bits_n))))
                      (ite (= (select Fresh1 ctr) (mk-some true))
                           (= kmac (select Keys1 (mk-tuple5 kid U V (maybe-get ni) (maybe-get nr))))
                           (= kmac (el11-9 (maybe-get (select State1 ctr))))
                           )))))))

(define-fun freshness-is-known
    ((state (Array Int (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                       (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                       (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int))))
     (fresh (Array Int (Maybe Bool))))
  Bool
  (let ((none (as mk-none (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                          (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                          (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int)))))
    (forall ((ctr Int))
            (let ((state (select state ctr)))
              (=> (not (= state none))
                  (not (= (select fresh ctr)
                          (as mk-none (Maybe Bool)))))))))

(define-fun freshness-and-honesty-matches
    ((state (Array Int (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                       (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                       (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int))))
     (fresh (Array Int (Maybe Bool)))
     (honest (Array Int (Maybe Bool))))
  Bool
  (let ((none (as mk-none (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                          (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                          (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int)))))
    (forall ((ctr Int))
            (let ((state (select state ctr)))
              (=> (not (is-mk-none state))
                  (let ((kid (el11-4  (maybe-get state))))
                    (= (select fresh ctr)
                       (select honest kid))))))))


(define-fun prf-package-set-consistently
    ((ltk (Array Int (Maybe Bits_n)))
     (hon (Array Int (Maybe Bool)))
     (prf (Array (Tuple2 Int (Tuple5 Int Int Bits_n Bits_n Bool)) (Maybe Bits_n))))
  Bool
  (and
   (forall ((kid Int))
           (and
            (=> (= (select ltk kid) (as mk-none (Maybe Bits_n)))
                (= (select hon kid) (as mk-none (Maybe Bool))))
            (=> (= (select hon kid) (as mk-none (Maybe Bool)))
                (= (select ltk kid) (as mk-none (Maybe Bits_n))))))
   (forall ((kid Int) (U Int) (V Int) (ni Bits_n) (nr Bits_n) (flag Bool))
           (=> (not (= (select prf (mk-tuple2 kid (mk-tuple5 U V ni nr flag)))
                       (as mk-none (Maybe Bits_n))))
               (not (= (select ltk kid)
                       (as mk-none (Maybe Bits_n))))))))


(define-fun mac-values-stored
    ((state (Array Int (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                       (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                       (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int))))
     (fresh (Array Int (Maybe Bool)))
     (values (Array (Tuple2 (Tuple5 Int Int Int Bits_n Bits_n) (Tuple2 Bits_n Int)) (Maybe Bits_n))))
  Bool
  (let ((none (as mk-none (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                          (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                          (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int)))))
    (forall ((ctr Int))
            (let ((state (select state ctr)))
              (=> (and (not (= state none))
                       (= (select fresh ctr) (mk-some true)))
                  (let  ((U    (el11-1  (maybe-get state)))
                         (u    (el11-2  (maybe-get state)))
                         (V    (el11-3  (maybe-get state)))
                         (kid  (el11-4  (maybe-get state)))
                         (acc  (el11-5  (maybe-get state)))
                         (k    (el11-6  (maybe-get state)))
                         (ni   (el11-7  (maybe-get state)))
                         (nr   (el11-8  (maybe-get state)))
                         (kmac (el11-9  (maybe-get state)))
                         (sid  (el11-10 (maybe-get state)))
                         (mess (el11-11 (maybe-get state))))
                    (let ((handle (mk-tuple5 kid U V (maybe-get ni) (maybe-get nr))))
                      (ite (< 0 mess)
                           (not (= (select values (mk-tuple2 handle (mk-tuple2 (maybe-get nr) 2)))
                                   (as mk-none (Maybe Bits_n))))
                           true
                           ))))))))

(define-fun revtesteval-populated
    ((revtesteval (Array (Tuple5 Int Int Int Bits_n Bits_n) (Maybe Int)))
     (H (Array Int (Maybe Bool)))
     (prf (Array (Tuple2 Int (Tuple5 Int Int Bits_n Bits_n Bool)) (Maybe Bits_n))))
  Bool
  (forall ((kid Int) (U Int) (V Int) (ni Bits_n) (nr Bits_n))
          (let ((pos-prf (mk-tuple2 kid (mk-tuple5 U V ni nr true)))
                (pos-rev (mk-tuple5 kid U V ni nr)))
            (and
             (=> (= (select prf pos-prf)
                    (as mk-none (Maybe Bits_n)))
                 (or (= (select H kid) (mk-some false))
                     (= (select revtesteval pos-rev)
                        (as mk-none (Maybe Int)))))
             (=> (= (select revtesteval pos-rev)
                    (as mk-none (Maybe Int)))
                 (= (select prf pos-prf)
                    (as mk-none (Maybe Bits_n))))))))


(define-fun sid-is-wellformed
    ((state (Array Int (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                       (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                       (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int))))
     (prf (Array (Tuple2 Int (Tuple5 Int Int Bits_n Bits_n Bool)) (Maybe Bits_n))))
  Bool
  (let ((none (as mk-none (Maybe (Tuple11 Int Bool Int Int (Maybe Bool) (Maybe Bits_n)
                                          (Maybe Bits_n) (Maybe Bits_n) (Maybe Bits_n)
                                          (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)) Int)))))
    (forall ((ctr Int))
            (let ((state (select state ctr)))
              (=> (not (= state none))
                  (let  ((U    (el11-1  (maybe-get state)))
                         (u    (el11-2  (maybe-get state)))
                         (V    (el11-3  (maybe-get state)))
                         (kid  (el11-4  (maybe-get state)))
                         (acc  (el11-5  (maybe-get state)))
                         (k    (el11-6  (maybe-get state)))
                         (ni   (el11-7  (maybe-get state)))
                         (nr   (el11-8  (maybe-get state)))
                         (kmac (el11-9  (maybe-get state)))
                         (sid  (el11-10 (maybe-get state)))
                         (mess (el11-11 (maybe-get state))))
                    (=> (not (= sid (as mk-none (Maybe (Tuple5 Int Int Bits_n Bits_n Bits_n)))))
                        (let ((tau (<<func-mac>> (maybe-get kmac) (maybe-get nr) 2)))
                          (= (mk-tuple5 U V
                                        (maybe-get ni) (maybe-get nr) tau)
                             (maybe-get sid))))))))))


(define-state-relation relation-trivial-equalities
    ((left  <GameState_H6_<$<!n!>$>>)
     (right  <GameState_H7_<$<!n!>$>>))
  (and (= left.Nonces.Nonces  right.Nonces.Nonces)
       (= left.PRF.LTK        right.PRF.LTK)
       (= left.PRF.H          right.PRF.H)
       (= left.PRF.kid_       right.PRF.kid_)
       (= left.KX.ctr_        right.KX.ctr_)
       (= left.KX.Fresh       right.KX.Fresh)
       (= left.KX.First       right.KX.First)
       (= left.KX.Second      right.KX.Second)
       (= left.KX.RevTested   right.KX.RevTested)
       (= left.KX.RevTestEval right.KX.RevTestEval)))

(define-state-relation invariant
    ((left  <GameState_H6_<$<!n!>$>>)
     (right  <GameState_H7_<$<!n!>$>>))
  (and (relation-no-overwriting-prf left right)
       (relation-trivial-equalities left right)

       (state-equality left.KX.State right.KX.State right.KX.Fresh)
       (prf-equality left.PRF.PRF right.PRF.PRF right.MAC.Keys)

       (freshness-and-honesty-matches left.KX.State left.KX.Fresh left.PRF.H)
       (freshness-and-honesty-matches right.KX.State right.KX.Fresh right.PRF.H)
       (freshness-is-known left.KX.State left.KX.Fresh)
       (freshness-is-known right.KX.State right.KX.Fresh)
       (stuff-not-initialized-early left.KX.State)
       (other-stuff-not-initialized-early right.KX.State right.KX.Fresh right.MAC.Keys)
       (kmac-sampled-consistently left.PRF.PRF right.MAC.Keys)
       (kmac-consistent-in-state-and-mac left.KX.State right.KX.State right.KX.Fresh right.MAC.Keys)
       (prf-package-set-consistently left.PRF.LTK left.PRF.H left.PRF.PRF)
       (prf-package-set-consistently right.PRF.LTK right.PRF.H right.PRF.PRF)
       (all-sessions-have-valid-keys left.KX.State left.PRF.LTK)
       (revtesteval-populated left.KX.RevTestEval left.PRF.H left.PRF.PRF)
       (revtesteval-populated right.KX.RevTestEval right.PRF.H right.PRF.PRF)
       (sid-is-wellformed left.KX.State left.PRF.PRF)))
