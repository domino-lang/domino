\newif\iffull\fullfalse% do not change flags here
\newif\ifdraft\draftfalse% do not change flags here

\fulltrue  % full  = long version (stuff to move to appendix)
\drafttrue % draft = comments and half-baked bits

%\pdfsuppressptexinfo-1

%
%\documentclass[letterpaper,table,dvipsnames,10pt]{article}
\documentclass[hyperref,envcountsame,envcountsect,runningheads]{llncs}%
\usepackage[dvipsnames]{xcolor}
\usepackage{hyperref}
% \pagestyle{plain}
%   \addtolength{\oddsidemargin}{-.5in}
%   \addtolength{\evensidemargin}{-.5in}
%   \addtolength{\textwidth}{1in}
\hypersetup{
    bookmarks=true,         % show bookmarks bar?
    unicode=false,          % non-Latin characters in Acrobat’s bookmarks
    colorlinks=true,       % false: boxed links; true: colored links
    linkcolor=RoyalPurple,          % color of internal links (change box color with linkbordercolor)
    citecolor=black,
    filecolor=black,
    urlcolor=black,
    hypertexnames=false
}
 \pagestyle{plain}
%   \addtolength{\oddsidemargin}{-1.6in}
%   \addtolength{\evensidemargin}{-1.6in}
%   \addtolength{\textwidth}{3.2in}

\def\topfraction{0.8}

\setcounter{tocdepth}{2}

%\usepackage{savetrees}
\usepackage{xspace}
\usepackage{lmodern}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{latexsym}
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{nameref}
%\usepackage{cleveref}
%\usepackage{amsthm}
\usepackage{tikz}
\usetikzlibrary{fit}

\usepackage{verbatim}
\usepackage{enumitem}
\usepackage[probability,adversary,sets,operators,primitives]{cryptocode}[=2018-11-11]
\usepackage{wrapfig}
\usepackage{booktabs}
\usepackage{pdfpages}
\usepackage{enumitem}
\usepackage{multicol}
\usepackage{catchfilebetweentags}
% \usepackage{lipsum}
\usepackage{url}
\usepackage{lscape}
\usepackage{subcaption}
\usepackage{todonotes}
\usepackage{placeins}
\usepackage{rotating}
\usepackage{thm-restate}

%\makeatletter
%\let\claim\@undefined
%\let\endclaim\@undefined
%\makeatother
%\spnewtheorem{claim}[theorem]{Claim}{\bfseries}{\itshape}

% include code in verbatim
\usepackage{listings}
\lstset{basicstyle=\footnotesize\ttfamily,
breaklines=true,
numbers=left,
tabsize=4,
escapeinside={<@}{@>}}

\let\llncssubparagraph\subparagraph
\let\subparagraph\paragraph
\usepackage{titlesec}
%\let\subparagraph\llncssubparagraph
\let\paragraph\subsubsection
\titlespacing*{\section} {0pt}{3ex plus 1ex minus .2ex}{2.1ex plus .2ex}
\titlespacing*{\subsection} {0pt}{2.75ex plus 1ex minus .2ex}{1.3ex plus .2ex}
\titlespacing*{\subsubsection}{0pt}{1ex plus 1ex minus .2ex}{2mm}

\input{macros}

%\usepackage{ntheorem}
%\theoremstyle{definition}
%\newtheorem{definition}{Definition}[section]
% \newtheorem{remark}{Remark}
%\newtheorem{corollary}{Corollary}
%\newtheorem{conjecture}{Conjecture}
%\newtheorem{construction}{Construction}
%\newtheorem{example}{Example}
%\newtheorem{hint}{Hint}
%\newtheorem{theorem}{Theorem}
%\newtheorem*{lemma*}{Lemma}
%\newtheorem{sublemma}{Lemma}[lemma]
%\newtheorem{myclaim}{Claim}[lemma]

\newcommand\defeq{\mathrel{\overset{\makebox[0pt]{\mbox{\normalfont\tiny\sffamily
def}}}{=}}}
\def\checkmark{\tikz\fill[scale=0.4](0,.35) -- (.25,0) -- (1,.7) --
  (.25,.15) -- cycle;}

% Submission version
%\newcommand{\workingnotes}[1]{}
%\newcommand{\workingnotes}[1]{\marginpar{\scriptsize{#1}}}
%\newcommand{\workingnotes}[1]{{#1}}

\newcommand{\vcaption}[1]{\vspace{-1ex}\caption{#1}\vspace{-1ex}}
\newcommand{\maxres}{L}
\newcommand{\psk}{\O{psk}}
\newcommand{\afterdeadline}[1]{}
\setuptodonotes{shadow}
\newcommand{\adl}[1]{} %{\todo[color=lightgray]{ADL: #1}}
\newcommand{\cb}[1]{} %{\todo[color=lime]{CB: #1}}
\newcommand{\chris}[1]{} %{\todo[color=lime]{CB: #1}}
\newcommand{\kk}[1]{} %{\todo[color=green!30]{KK: #1}}
\newcommand{\cf}[1]{} %{\todo[color=blue!30]{CF: #1}}
\newcommand{\CF}[1]{} %{\todo[color=blue!30,bordercolor=red]{CF: #1}}
\newcommand{\mk}[1]{\todo[color=red!30]{MK: #1}}
\newcommand{\MK}[1]{\todo[color=red!30,bordercolor=red]{MK: #1}}
\newcommand{\mklight}[1]{}
\renewcommand{\vec}[1]{\ensuremath{\mathbf{#1}}}
\renewcommand\pcthen{:}

\title{SSBee Tutorial}
%\author{}\institute{}
\author{Chris Brzuska\inst{1}, Christoph Egger\inst{2}, Jan Winkelmann\inst{3}}
\institute{
			 Aalto University, Finland \and Chalmers University, Sweden \and Free spirit
}

\let\oldprocedure\procedure
\renewcommand\procedure[2][]{\oldprocedure[#1,codesize=\small{}]{\small#2}}

\definecolor{kxpink}{RGB}{211,77,122} % D34D7A
\newcommand\pink{\textcolor{kxpink}{pink}}
\definecolor{kxblue}{RGB}{51, 171, 189} % #33abbd
\newcommand\blue{\textcolor{kxblue}{blue}}
\newcommand\gray{\textcolor{gray}{gray}}


\begin{document}
\maketitle
%\vspace{-1.3cm}


\tableofcontents

\clearpage
\section{Technical overview}\label{sec:overview}
This is a technical overview. See Section~\ref{sec:conceptualoverview} for a \emph{conceptual} overview. In order to run SSBee, you need a recent version of Rust as well as the SMT-solver CVC5 (or the SMT-solver Z3). In example-projects, you find the hello-world folder which is a good starting point to see how SSBee projects are structured. 

\begin{wrapfigure}{R}{0.18\textwidth}
\vspace{-0.7cm}
\scalebox{0.8}{
\includegraphics{hello-world.png}
}
\vspace{-1cm}
\end{wrapfigure}

Namely, the hello-world folder contains packages which contain oracle parameters, package state and oracles operating on the oracle state (cf. Section~\ref{sec:packages}), games which contain game parameters and can wire instances of the previously defined packages into a game (cf. Section~\ref{sec:games}). Finally, the proof folder contains one or multiple proofs which contain one more multiple statements to be proven about previously defined games; a proof step is either a \emph{reduction} or a \emph{code equivalence}. See Section~\ref{sec:proofs} for details. Packages have file extension .pkg.ssp, games have file extension .comp.ssp (for \underline{comp}osition), and proofs just have file extension .ssp. Here are three useful commands which you can run in the hello-world folder (or any other project folder):

\begin{description}
\item[cargo run -p ssbee prove:] This command verifies the proof in the folder.
\item[cargo run -p ssbee prove --transcript:] This command verifies the proof in the folder and writes the resulting smt file into hello-world/$\_$build/code$\_$eq, which is usually not needed, but can be interesting if you want to understand what is going on on the SMT level, especially if the SMT solver gives you a counterexample to your proof.
\item[cargo run -p ssbee latex:] This command generates LaTeX code to nicely display the code and games of your project (cf. Section~\ref{sec:latex}) in a PDF. Before doing so, it type-checks the code of packages and games and verifies the reductions, since the command also generates pictures for reductions. This command does not verify code-equivalences.
\end{description}


\subsection{Packages}\label{sec:packages}

\begin{wrapfigure}{R}{0.18\textwidth}
\vspace{-0.75cm}
\scalebox{0.7}{
\includegraphics{hello-world-rnd.png}
}
\vspace{-1cm}
\end{wrapfigure}

We explain the structure of a package on the example of the $\M{Rand}$ package in hello-world/packages. Conceptually, this package allows to do a (somewhat) useful operation and a pretty useless operation. The useful operation is that it allows to sample random strings from $\bin^n$ and counts how many random strings it has already sampled. In turn, the (pretty) useless operation takes an integer as input and throws an error whenever that integer is not $1$.

\begin{wrapfigure}{R}{0.615\textwidth}
%\vspace{-0.5cm}
\scalebox{0.37}{
\includegraphics{hello-world-rnd-code.png}
}
\vspace{-1cm}
\end{wrapfigure}

Let's now have a look at the actual implementation of the $\M{Rand}$ package. Concretely, this package has $n$ as a parameter (which is needed to define the set $\bin^n$) and maintains a counter {\tt{ctr}} in its state (which is an integer). The $\O{UsefulOracle}$ can be queried with an empty input, then increments the counter {\tt{ctr}}, samples a random string {\tt{rand}} uniformly from the set $\bin^n$ and returns the pair $({\tt{ctr}},{\tt{rand}})$, i.e., an integer and a string of type Bits(n), our encoding of $\bin^n$. The $\O{UselessOracle}$, in turn, can be queried with any integer $x$. If $x\neq 1$, 

\noindent
the $\O{UselessOracle}$ throws an error (This is the meaning of $\mathbf{assert}$.). Else, it samples a random string {\tt{rand}} uniformly from the set $\bin^n$ (which it does not use and thus is a useless operation) and then returns $1$. See Appendix~\ref{app:code} for a complete description of the SSBee pseudo-code syntax.

Additionally, the packages folder also contains the $\M{Fwd}$ package which also has a $\O{UsefulOracle}$, but its code is different. Namely, when called (with an empty input), $\O{UsefulOracle}$ just forwards the call to another $\O{UsefulOracle}$ oracle (provided by some other package) and returns whatever that call returns.
In turn, $\M{Fwd}$ also has a $\O{UselessOracle}$ with the same code as in the $\M{Rand}$ package, except that it omits the useless additional sampling of {\tt{rand}}.


\subsection{Games}\label{sec:games}
We explain the structure of a game on the examples of the games $\M{SmallComposition}$ and $\M{BigComposition}$ in hello-world/games.


%To turn a package into a package instance, the game specifies
%use the packages and finally one or multiple proof files which specify game instances
%If you run cargo run prove in the hello-world folder, SSBee will verify the proof in hello-world (to be discussed shortly). If you run cargo run latex,

\subsection{Proofs}\label{sec:proofs}


\subsection{Generating LaTeX}\label{sec:latex}


%\begin{abstract}
%Very concrete.
%\end{abstract}

%\tableofcontents

%\input{introduction}
%\input{ssp}
%\input{ssbee}


%\input{technical-overview}

%\input{notation}
%\input{key-exchange-syntax}
%\input{key-schedule-syntax}




%{\footnotesize
%\bibliography{cryptobib/abbrev3,cryptobib/crypto,misc}{}
%\bibliography{cryptobib/abbrev3,cryptobib/crypto,local}{}
%\bibliographystyle{abbrv}
%}
%\clearpage

\appendix
\section{Code}\label{app:code}

\end{document}
